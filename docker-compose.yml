version: "3"

services:
  #  express/node React app
  unity-hospital:
    image: unity-hospital
    expose:
      - 3000
    ports:
      - 3000:3000
    build:
      dockerfile: Dockerfile.dev
      context: ./unity-hospital
    volumes:
      - /app/node_modules
      - ./unity-hospital:/app
		stdin_open: true
		# current causes 'nginx: [emerg] host not found in upstream "unity-hospital:3000" in /etc/nginx/conf.d/default.conf:2'
    # links:
    #   - "api-events:api-events"
    #   - "api-users:api-users"

  #  express/node api with postgres
  api-users:
    image: api-users
    build:
      dockerfile: Dockerfile.dev
      context: ./unity-api
    env_file:
      - .env
    volumes:
      - /app/node_modules
      - ./unity-api:/app

  #  flask api with MongoDB
  api-events:
    image: api-events
    expose:
      - 4433
    ports:
      - 4433:4433
    build:
      dockerfile: Dockerfile.dev
      context: ./unity-data-solutions
    env_file:
      - .env
    volumes:
      - ./unity-data-solutions:/app

  ##############################
  #  nginx server for routing
  ##############################
  nginx:
    image: nginx
    restart: always
    build:
      dockerfile: Dockerfile.dev
      context: ./nginx
    ports:
      - "8080:80"
